<!doctype html>



  


<html class="theme-next muse use-motion">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  
  
  <link href="/vendors/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/vendors/font-awesome/css/font-awesome.min.css?v=4.4.0" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.0.1" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Android," />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.0.1" />






<meta name="description" content="&amp;#x4EC0;&amp;#x4E48;&amp;#x662F;&amp;#x5185;&amp;#x5B58;&amp;#x6CC4;&amp;#x6F0F;&amp;#x53EA;&amp;#x8981;&amp;#x662F;&amp;#x73B0;&amp;#x4EE3;&amp;#x667A;&amp;#x80FD;&amp;#x7535;&amp;#x5B50;&amp;#x8BBE;&amp;#x5907;&amp;#xFF0C;&amp;#x4E0D;&amp;#x7BA1;&amp;#x6216;&amp;#x5927;&amp;#x6216;&amp;#x5C0F;">
<meta property="og:type" content="article">
<meta property="og:title" content="Android 内存优化不完全手册">
<meta property="og:url" content="http://jasoncool.com/2018/08/29/Android-内存优化不完全手册/index.html">
<meta property="og:site_name" content="移动开发小水吧">
<meta property="og:description" content="&amp;#x4EC0;&amp;#x4E48;&amp;#x662F;&amp;#x5185;&amp;#x5B58;&amp;#x6CC4;&amp;#x6F0F;&amp;#x53EA;&amp;#x8981;&amp;#x662F;&amp;#x73B0;&amp;#x4EE3;&amp;#x667A;&amp;#x80FD;&amp;#x7535;&amp;#x5B50;&amp;#x8BBE;&amp;#x5907;&amp;#xFF0C;&amp;#x4E0D;&amp;#x7BA1;&amp;#x6216;&amp;#x5927;&amp;#x6216;&amp;#x5C0F;">
<meta property="og:updated_time" content="2018-08-30T02:31:18.472Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Android 内存优化不完全手册">
<meta name="twitter:description" content="&amp;#x4EC0;&amp;#x4E48;&amp;#x662F;&amp;#x5185;&amp;#x5B58;&amp;#x6CC4;&amp;#x6F0F;&amp;#x53EA;&amp;#x8981;&amp;#x662F;&amp;#x73B0;&amp;#x4EE3;&amp;#x667A;&amp;#x80FD;&amp;#x7535;&amp;#x5B50;&amp;#x8BBE;&amp;#x5907;&amp;#xFF0C;&amp;#x4E0D;&amp;#x7BA1;&amp;#x6216;&amp;#x5927;&amp;#x6216;&amp;#x5C0F;">



<script type="text/javascript" id="hexo.configuration">
  var NexT = window.NexT || {};
  var CONFIG = {
    scheme: 'Muse',
    sidebar: {"position":"left","display":"post"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: 0,
      author: '博主'
    }
  };
</script>




  <link rel="canonical" href="http://jasoncool.com/2018/08/29/Android-内存优化不完全手册/"/>

  <title> Android 内存优化不完全手册 | 移动开发小水吧 </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  










  
  
    
  

  <div class="container one-collumn sidebar-position-left page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">移动开发小水吧</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle">没啥高深技术，只求水水更健康！</p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup">
 <span class="search-icon fa fa-search"></span>
 <input type="text" id="local-search-input">
 <div id="local-search-result"></div>
 <span class="popup-btn-close">close</span>
</div>


    </div>
  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                Android 内存优化不完全手册
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2018-08-29T08:43:53+08:00" content="Aug 29 2018">
              Aug 29 2018
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/Android/" itemprop="url" rel="index">
                    <span itemprop="name">Android</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2018/08/29/Android-内存优化不完全手册/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2018/08/29/Android-内存优化不完全手册/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        <h2 id="&#x4EC0;&#x4E48;&#x662F;&#x5185;&#x5B58;&#x6CC4;&#x6F0F;">&#x4EC0;&#x4E48;&#x662F;&#x5185;&#x5B58;&#x6CC4;&#x6F0F;</h2><p>&#x53EA;&#x8981;&#x662F;&#x73B0;&#x4EE3;&#x667A;&#x80FD;&#x7535;&#x5B50;&#x8BBE;&#x5907;&#xFF0C;&#x4E0D;&#x7BA1;&#x6216;&#x5927;&#x6216;&#x5C0F;&#xFF0C;&#x90FD;&#x4F1A;&#x6709;&#x4E00;&#x4E2A;&#x53EB;&#x505A;&#x5185;&#x5B58;&#x7684;&#x786C;&#x4EF6;&#xFF0C;&#x5728;&#x624B;&#x673A;&#x4E2D;&#x8FD9;&#x4E2A;&#x786C;&#x4EF6;&#x7684;&#x53C2;&#x6570;&#x5C24;&#x4E3A;&#x91CD;&#x8981;&#xFF0C;&#x662F;&#x6211;&#x4EEC;&#x8BC4;&#x4EF7;&#x4E00;&#x4E2A;&#x624B;&#x673A;&#x597D;&#x574F;&#x7684;&#x6807;&#x51C6;&#x4E4B;&#x4E00;&#x3002;</p>
<p>&#x4EE5;Android&#x624B;&#x673A;&#x4E3A;&#x4F8B;&#xFF0C;&#x6211;&#x4EEC;&#x5F00;&#x53D1;&#x7684;&#x7A0B;&#x5E8F;&#x5982;&#x679C;&#x60F3;&#x8981;&#x8FD0;&#x884C;&#x8D77;&#x6765;&#xFF0C;&#x5C31;&#x9700;&#x8981;&#x5F00;&#x542F;&#x4E00;&#x4E2A;&#x72EC;&#x7ACB;&#x7684;&#x8FDB;&#x7A0B;&#xFF0C;&#x800C;&#x8FD9;&#x4E2A;&#x8FDB;&#x7A0B;&#x5982;&#x679C;&#x60F3;&#x8981;&#x8FD0;&#x884C;&#x8D77;&#x6765;&#xFF0C;&#x5C31;&#x5FC5;&#x987B;&#x5360;&#x7528;&#x4E00;&#x90E8;&#x5206;&#x7684;&#x5185;&#x5B58;&#xFF0C;&#x8FD9;&#x5C31;&#x662F;&#x6211;&#x4EEC;&#x7684;&#x5E94;&#x7528;&#x548C;&#x624B;&#x673A;&#x5185;&#x5B58;&#x4E4B;&#x95F4;&#x7684;&#x5173;&#x7CFB;&#x4E86;&#x3002;<br>&#x8BF4;&#x5230;&#x8FD9;&#x91CC;&#xFF0C;&#x6211;&#x4EEC;&#x5C31;&#x53EF;&#x4EE5;&#x804A;&#x804A;&#x5185;&#x5B58;&#x6CC4;&#x6F0F;&#x4E86;&#xFF08;&#x4EE5;&#x4E0B;&#x5185;&#x5BB9;&#x6765;&#x81EA;&#x767E;&#x5EA6;&#x767E;&#x79D1;&#xFF09;&#x3002;</p>
<blockquote>
<p>&#x5185;&#x5B58;&#x6CC4;&#x6F0F;&#xFF08;Memory Leak&#xFF09;&#x662F;&#x6307;&#x7A0B;&#x5E8F;&#x4E2D;&#x5DF1;&#x52A8;&#x6001;&#x5206;&#x914D;&#x7684;&#x5806;&#x5185;&#x5B58;&#x7531;&#x4E8E;&#x67D0;&#x79CD;&#x539F;&#x56E0;&#x7A0B;&#x5E8F;&#x672A;&#x91CA;&#x653E;&#x6216;&#x65E0;&#x6CD5;&#x91CA;&#x653E;&#xFF0C;&#x9020;&#x6210;&#x7CFB;&#x7EDF;&#x5185;&#x5B58;&#x7684;&#x6D6A;&#x8D39;&#xFF0C;&#x5BFC;&#x81F4;&#x7A0B;&#x5E8F;&#x8FD0;&#x884C;&#x901F;&#x5EA6;&#x51CF;&#x6162;&#x751A;&#x81F3;&#x7CFB;&#x7EDF;&#x5D29;&#x6E83;&#x7B49;&#x4E25;&#x91CD;&#x540E;&#x679C;&#x3002;</p>
<p>&#x5185;&#x5B58;&#x6CC4;&#x6F0F;&#x7F3A;&#x9677;&#x5177;&#x6709;&#x9690;&#x853D;&#x6027;&#x3001;&#x79EF;&#x7D2F;&#x6027;&#x7684;&#x7279;&#x5F81;&#xFF0C;&#x6BD4;&#x5176;&#x4ED6;&#x5185;&#x5B58;&#x975E;&#x6CD5;&#x8BBF;&#x95EE;&#x9519;&#x8BEF;&#x66F4;&#x96BE;&#x68C0;&#x6D4B;&#x3002;&#x56E0;&#x4E3A;&#x5185;&#x5B58;&#x6CC4;&#x6F0F;&#x7684;&#x4EA7;&#x751F;&#x539F;&#x56E0;&#x662F;&#x5185;&#x5B58;&#x5757;&#x672A;&#x88AB;&#x91CA;&#x653E;&#xFF0C;&#x5C5E;&#x4E8E;&#x9057;&#x6F0F;&#x578B;&#x7F3A;&#x9677;&#x800C;&#x4E0D;&#x662F;&#x8FC7;&#x9519;&#x578B;&#x7F3A;&#x9677;&#x3002;&#x6B64;&#x5916;&#xFF0C;&#x5185;&#x5B58;&#x6CC4;&#x6F0F;&#x901A;&#x5E38;&#x4E0D;&#x4F1A;&#x76F4;&#x63A5;&#x4EA7;&#x751F;&#x53EF;&#x89C2;&#x5BDF;&#x7684;&#x9519;&#x8BEF;&#x75C7;&#x72B6;&#xFF0C;&#x800C;&#x662F;&#x9010;&#x6E10;&#x79EF;&#x7D2F;&#xFF0C;&#x964D;&#x4F4E;&#x7CFB;&#x7EDF;&#x6574;&#x4F53;&#x6027;&#x80FD;&#xFF0C;&#x6781;&#x7AEF;&#x7684;&#x60C5;&#x51B5;&#x4E0B;&#x53EF;&#x80FD;&#x4F7F;&#x7CFB;&#x7EDF;&#x5D29;&#x6E83;&#x3002;</p>
</blockquote>
<p>&#x767E;&#x5EA6;&#x767E;&#x79D1;&#x7684;&#x89E3;&#x91CA;&#x5DF2;&#x7ECF;&#x5F88;&#x660E;&#x767D;&#x4E86;&#xFF0C;&#x5177;&#x4F53;&#x5230;&#x7A0B;&#x5E8F;&#x65B9;&#x9762;&#x6765;&#x8BF4;&#xFF0C;&#x57FA;&#x672C;&#x4E0A;&#x5C31;&#x662F;&#x8BE5;&#x56DE;&#x6536;&#x7684;&#x5BF9;&#x8C61;&#x7531;&#x4E8E;&#x4E00;&#x4E9B;&#x539F;&#x56E0;&#x65E0;&#x6CD5;&#x6B63;&#x5E38;&#x56DE;&#x6536;&#xFF0C;&#x8FD9;&#x6837;&#x7684;&#x5BF9;&#x8C61;&#x8D8A;&#x6765;&#x8D8A;&#x591A;&#x5BFC;&#x81F4;&#x624B;&#x673A;&#x7684;&#x5185;&#x5B58;&#x5360;&#x7528;&#x7387;&#x5C45;&#x9AD8;&#x4E0D;&#x4E0B;&#xFF0C;&#x53EF;&#x7528;&#x7684;&#x7A7A;&#x95F2;&#x5185;&#x5B58;&#x8D8A;&#x6765;&#x8D8A;&#x5C11;&#xFF0C;&#x4ECE;&#x800C;&#x9891;&#x7E41;&#x7684;&#x89E6;&#x53D1;&#x5783;&#x573E;&#x56DE;&#x6536;&#x673A;&#x5236;&#xFF0C;&#x4EE5;&#x81F3;&#x4E8E;&#x964D;&#x4F4E;&#x4E86;&#x5E94;&#x7528;&#x7684;&#x6D41;&#x7545;&#x5EA6;&#xFF0C;&#x4E25;&#x91CD;&#x7684;&#x65F6;&#x5019;&#x4F1A;&#x5BFC;&#x81F4;&#x5185;&#x5B58;&#x6EA2;&#x51FA;&#xFF08;OOM Out Of Memory&#xFF09;&#x7684;&#x95EE;&#x9898;&#xFF0C;&#x5BFC;&#x81F4;&#x7A0B;&#x5E8F;&#x5D29;&#x6E83;&#x3002;</p>
<p>&#x81F3;&#x4E8E;&#x4EC0;&#x4E48;&#x662F;&#x5185;&#x5B58;&#x6EA2;&#x51FA;&#xFF0C;&#x8BF7;&#x81EA;&#x884C;&#x641C;&#x7D22;&#x5B66;&#x4E60;&#xFF0C;&#x8BE5;&#x77E5;&#x8BC6;&#x70B9;&#x4E0D;&#x5728;&#x672C;&#x7BC7;&#x6559;&#x7A0B;&#x5185;&#x3002;</p>
<a id="more"></a>
<h2 id="Java&#x7684;&#x56DB;&#x79CD;&#x5F15;&#x7528;">Java&#x7684;&#x56DB;&#x79CD;&#x5F15;&#x7528;</h2><p>&#x804A;&#x5230;Java&#x7684;&#x56DB;&#x79CD;&#x5F15;&#x7528;&#xFF0C;&#x5176;&#x5B9E;&#x4E5F;&#x662F;&#x4E00;&#x4E2A;&#x77E5;&#x8BC6;&#x70B9;&#x7684;&#x52A0;&#x56FA;&#xFF0C;&#x56E0;&#x4E3A;&#x4E00;&#x4E9B;&#x8003;&#x8651;&#x5230;&#x5185;&#x5B58;&#x6CC4;&#x6F0F;&#x7684;&#x89E3;&#x51B3;&#x65B9;&#x6848;&#x4E2D;&#xFF0C;&#x9700;&#x8981;&#x7528;&#x5230;&#x8FD9;&#x91CC;&#x7684;&#x77E5;&#x8BC6;&#x70B9;&#xFF0C;&#x6240;&#x4EE5;&#x5148;&#x8BB2;&#x89E3;&#x7ED9;&#x5927;&#x5BB6;&#xFF1A;</p>
<ul>
<li>&#x5F3A;&#x5F15;&#x7528;&#xFF1A;&#x5F3A;&#x5F15;&#x7528;&#x662F;Java&#x4E2D;&#x6700;&#x666E;&#x901A;&#x7684;&#x5F15;&#x7528;&#xFF0C;&#x968F;&#x610F;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x5BF9;&#x8C61;&#x7136;&#x540E;&#x5728;&#x5176;&#x4ED6;&#x7684;&#x5730;&#x65B9;&#x5F15;&#x7528;&#x4E00;&#x4E0B;&#xFF0C;&#x5C31;&#x662F;&#x5F3A;&#x5F15;&#x7528;&#xFF0C;<strong>&#x5F3A;&#x5F15;&#x7528;&#x7684;&#x5BF9;&#x8C61;Java&#x5B81;&#x613F;OOM&#x4E5F;&#x4E0D;&#x4F1A;&#x56DE;&#x6536;&#x4ED6;</strong></li>
<li><strong>&#x8F6F;&#x5F15;&#x7528;</strong>: &#x8F6F;&#x5F15;&#x7528;&#x662F;&#x6BD4;&#x5F3A;&#x5F15;&#x7528;&#x5F31;&#x7684;&#x5F15;&#x7528;&#xFF0C;&#x5728;Java gc&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x5982;&#x679C;&#x8F6F;&#x5F15;&#x7528;&#x6240;&#x5F15;&#x7528;&#x7684;&#x5BF9;&#x8C61;&#x88AB;&#x56DE;&#x6536;&#xFF0C;&#x9996;&#x6B21;gc&#x5931;&#x8D25;&#x7684;&#x8BDD;&#x4F1A;&#x7EE7;&#x800C;&#x56DE;&#x6536;&#x8F6F;&#x5F15;&#x7528;&#x7684;&#x5BF9;&#x8C61;&#xFF0C;<strong>&#x8F6F;&#x5F15;&#x7528;&#x9002;&#x5408;&#x505A;&#x7F13;&#x5B58;&#x5904;&#x7406;</strong> &#x53EF;&#x4EE5;&#x548C;&#x5F15;&#x7528;&#x961F;&#x5217;&#xFF08;ReferenceQueue&#xFF09;&#x4E00;&#x8D77;&#x4F7F;&#x7528;&#xFF0C;&#x5F53;&#x5BF9;&#x8C61;&#x88AB;&#x56DE;&#x6536;&#x4E4B;&#x540E;&#x4FDD;&#x5B58;&#x4ED6;&#x7684;&#x8F6F;&#x5F15;&#x7528;&#x4F1A;&#x653E;&#x5165;&#x5F15;&#x7528;&#x961F;&#x5217;</li>
<li><strong>&#x5F31;&#x5F15;&#x7528;</strong>: &#x5F31;&#x5F15;&#x7528;&#x662F;&#x6BD4;&#x8F6F;&#x5F15;&#x7528;&#x66F4;&#x52A0;&#x5F31;&#x7684;&#x5F15;&#x7528;&#xFF0C;&#x5F53;Java&#x6267;&#x884C;gc&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x5982;&#x679C;&#x5F31;&#x5F15;&#x7528;&#x6240;&#x5F15;&#x7528;&#x7684;&#x5BF9;&#x8C61;&#x88AB;&#x56DE;&#x6536;&#xFF0C;&#x65E0;&#x8BBA;&#x4ED6;&#x6709;&#x6CA1;&#x6709;&#x7528;&#x90FD;&#x4F1A;&#x56DE;&#x6536;&#x6389;&#x5F31;&#x5F15;&#x7528;&#x7684;&#x5BF9;&#x8C61;&#xFF0C;&#x4E0D;&#x8FC7;gc&#x662F;&#x4E00;&#x4E2A;&#x6BD4;&#x8F83;&#x4F4E;&#x4F18;&#x5148;&#x7EA7;&#x7684;&#x7EBF;&#x7A0B;&#xFF0C;&#x4E0D;&#x4F1A;&#x90A3;&#x4E48;&#x53CA;&#x65F6;&#x7684;&#x56DE;&#x6536;&#x6389;&#x4F60;&#x7684;&#x5BF9;&#x8C61;&#x3002; <strong>&#x53EF;&#x4EE5;&#x548C;&#x5F15;&#x7528;&#x961F;&#x5217;&#x4E00;&#x8D77;&#x4F7F;&#x7528;&#xFF0C;&#x5F53;&#x5BF9;&#x8C61;&#x88AB;&#x56DE;&#x6536;&#x4E4B;&#x540E;&#x4FDD;&#x5B58;&#x4ED6;&#x7684;&#x5F31;&#x5F15;&#x7528;&#x4F1A;&#x653E;&#x5165;&#x5F15;&#x7528;&#x961F;&#x5217;</strong></li>
<li><strong>&#x865A;&#x5F15;&#x7528;</strong>: &#x865A;&#x5F15;&#x7528;&#x548C;&#x6CA1;&#x6709;&#x5F15;&#x7528;&#x662F;&#x4E00;&#x6837;&#x7684;&#xFF0C;&#x4ED6;&#x5FC5;&#x987B;&#x548C;&#x5F15;&#x7528;&#x961F;&#x5217;&#x4E00;&#x8D77;&#x4F7F;&#x7528;&#xFF0C;&#x5F53;Java&#x56DE;&#x6536;&#x4E00;&#x4E2A;&#x5BF9;&#x8C61;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x5982;&#x679C;&#x53D1;&#x73B0;&#x4ED6;&#x6709;&#x865A;&#x5F15;&#x7528;&#xFF0C;&#x4F1A;&#x5728;&#x56DE;&#x6536;&#x5BF9;&#x8C61;&#x4E4B;&#x524D;&#x5C06;&#x4ED6;&#x7684;&#x865A;&#x5F15;&#x7528;&#x52A0;&#x5165;&#x5230;&#x4E0E;&#x4E4B;&#x5173;&#x8054;&#x7684;&#x5F15;&#x7528;&#x961F;&#x5217;&#x4E2D;&#x3002;<strong>&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x8FD9;&#x4E2A;&#x7279;&#x6027;&#x5728;&#x4E00;&#x4E2A;&#x5BF9;&#x8C61;&#x88AB;&#x56DE;&#x6536;&#x4E4B;&#x524D;&#x91C7;&#x53D6;&#x63AA;&#x65BD;</strong></li>
</ul>
<p>&#x5177;&#x4F53;&#x7528;&#x6CD5;&#x53EF;&#x4EE5;&#x81EA;&#x5DF1;&#x67E5;&#x8BE2;&#x4E00;&#x4E0B;&#xFF0C;&#x5199;&#x51E0;&#x4E2A;&#x4F8B;&#x5B50;&#xFF0C;&#x8FD9;&#x91CC;&#x5C31;&#x4E0D;&#x5C55;&#x5F00;&#x8BB2;&#x4E86;&#x3002;</p>
<h2 id="&#x5E38;&#x89C1;&#x5185;&#x5B58;&#x6CC4;&#x6F0F;">&#x5E38;&#x89C1;&#x5185;&#x5B58;&#x6CC4;&#x6F0F;</h2><ul>
<li><p>&#x975E;&#x9759;&#x6001;&#x5185;&#x90E8;&#x7C7B;&#x548C;&#x533F;&#x540D;&#x5185;&#x90E8;&#x7C7B;&#x9020;&#x6210;&#x7684;&#x5185;&#x5B58;&#x6CC4;&#x6F0F;</p>
<p>&#x8FD9;&#x91CC;&#x9996;&#x5148;&#x6211;&#x4EEC;&#x4E86;&#x89E3;&#x4E00;&#x4E0B;&#x5185;&#x90E8;&#x7C7B;&#x548C;&#x9759;&#x6001;&#x5185;&#x90E8;&#x7C7B;&#x7684;&#x533A;&#x522B;&#xFF1A;</p>
<p>|        &#x4E24;&#x79CD;&#x7C7B;&#x5BF9;&#x6BD4;&#x9879;        |          &#x9759;&#x6001;&#x5185;&#x90E8;&#x7C7B;          |     &#x975E;&#x9759;&#x6001;&#x5185;&#x90E8;&#x7C7B;     |<br>| :&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;: | :&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2013;: | :&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;&#x2014;: |<br>|     &#x4E0E;&#x5916;&#x90E8;&#x7C7B;&#x7684;&#x5F15;&#x7528;&#x5173;&#x7CFB;     | &#x5982;&#x679C;&#x6CA1;&#x6709;&#x4F20;&#x5165;&#x53C2;&#x6570;&#x5219;&#x65E0;&#x5F15;&#x7528;&#x5173;&#x7CFB; |  &#x81EA;&#x52A8;&#x83B7;&#x5F97;&#x5F3A;&#x5F15;&#x7528;&#x5173;&#x7CFB;  |<br>|    &#x88AB;&#x8C03;&#x7528;&#x65F6;&#x9700;&#x8981;&#x5916;&#x90E8;&#x5B9E;&#x4F8B;    |            &#x4E0D;&#x9700;&#x8981;            |         &#x9700;&#x8981;         |<br>| &#x80FD;&#x5426;&#x4F7F;&#x7528;&#x5916;&#x90E8;&#x7C7B;&#x7684;&#x975E;&#x9759;&#x6001;&#x6210;&#x5458; |             &#x4E0D;&#x80FD;             |          &#x80FD;          |<br>|          &#x751F;&#x547D;&#x5468;&#x671F;          |        &#x81EA;&#x4E3B;&#x7684;&#x751F;&#x547D;&#x5468;&#x671F;        | &#x4F9D;&#x8D56;&#x5916;&#x90E8;&#x7C7B;&#xFF0C;&#x751A;&#x81F3;&#x66F4;&#x957F; |</p>
<p>&#x9996;&#x5148;&#x6211;&#x4EEC;&#x8981;&#x8003;&#x8651;&#x4E00;&#x4E0B;&#xFF0C;&#x5728;Android&#x91CC;&#x4EC0;&#x4E48;&#x65F6;&#x5019;&#x6211;&#x4EEC;&#x4F1A;&#x7528;&#x5230;&#x5185;&#x90E8;&#x7C7B;&#x5462;&#xFF1F;</p>
<p>&#x6700;&#x5E38;&#x89C1;&#x7684;&#x5C31;&#x662F;Handler&#x3001;AysncTask&#x548C;Thread&#x8FD9;&#x4E09;&#x4E2A;&#x7C7B;&#x4E86;&#xFF0C;&#x6240;&#x4EE5;&#x8FD9;&#x5C31;&#x4F1A;&#x9020;&#x6210;&#x4E00;&#x4E2A;&#x5185;&#x5B58;&#x6CC4;&#x6F0F;&#x7684;&#x9690;&#x60A3;&#xFF0C;&#x90A3;&#x5C31;&#x662F;&#x5982;&#x679C;&#x6211;&#x4EEC;&#x6B63;&#x5728;&#x901A;&#x8FC7;Handler&#x8BF7;&#x6C42;&#x7F51;&#x7EDC;&#x6570;&#x636E;&#xFF0C;&#x8FD9;&#x65F6;&#x6211;&#x4EEC;&#x7A81;&#x7136;&#x5173;&#x95ED;&#x4E86;Activity,&#x4F46;&#x662F;&#x7F51;&#x7EDC;&#x8BF7;&#x6C42;&#x5E76;&#x6CA1;&#x6709;&#x7ED3;&#x675F;&#xFF0C;&#x6B64;&#x65F6;&#x4F5C;&#x4E3A;&#x5185;&#x90E8;&#x7C7B;&#x7684;Handler&#x8FD8;&#x6301;&#x6709;&#x5916;&#x90E8;Activity&#x7684;&#x5F3A;&#x5F15;&#x7528;&#x5173;&#x7CFB;&#xFF0C;&#x4ECE;&#x800C;&#x5BFC;&#x81F4;&#x8BE5;Activity&#x7684;&#x5185;&#x5B58;&#x5E76;&#x6CA1;&#x6709;&#x88AB;&#x6B63;&#x5E38;&#x56DE;&#x6536;&#xFF0C;&#x8FD9;&#x5C31;&#x53D1;&#x751F;&#x4E86;&#x5185;&#x5B58;&#x6CC4;&#x6F0F;&#xFF0C;&#x800C;&#x4E14;&#x8FD8;&#x6709;&#x53EF;&#x80FD;&#x9020;&#x6210;&#x4E00;&#x4E9B;&#x4E0D;&#x53EF;&#x9884;&#x6D4B;&#x7684;&#x7A7A;&#x6307;&#x9488;&#x7684;&#x95EE;&#x9898;&#x3002;</p>
<p>&#x4E0B;&#x9762;&#x5C06;&#x4E09;&#x4E2A;&#x7C7B;&#x7684;&#x5185;&#x5B58;&#x6CC4;&#x6F0F;&#x53CA;&#x89E3;&#x51B3;&#x65B9;&#x6848;&#x90FD;&#x5217;&#x51FA;&#x6765;&#xFF0C;&#x4EE5;&#x540E;&#x9047;&#x5230;&#x7C7B;&#x4F3C;&#x7684;&#x95EE;&#x9898;&#x5C31;&#x53EF;&#x4EE5;&#x907F;&#x514D;&#x4E86;&#xFF1A;</p>
<ol>
<li><p>AsyncTask</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AsyncTaskOOMActivity</span> <span class="keyword">extends</span> <span class="title">AppCompatActivity</span> </span>{</span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(@Nullable Bundle savedInstanceState)</span> </span>{</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        <span class="keyword">new</span> MyAsyncTask().execute();</span><br><span class="line">    }</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">MyAsyncTask</span> <span class="keyword">extends</span> <span class="title">AsyncTask</span>&lt;<span class="title">Void</span>,<span class="title">Integer</span>,<span class="title">String</span>&gt;</span>{</span><br><span class="line">        <span class="annotation">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">protected</span> String <span class="title">doInBackground</span><span class="params">(Void... voids)</span> </span>{</span><br><span class="line">            <span class="keyword">try</span> {</span><br><span class="line">                Thread.sleep(<span class="number">5000</span>);</span><br><span class="line">            } <span class="keyword">catch</span> (InterruptedException e) {</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            }</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<p>&#x8FD9;&#x79CD;&#x5199;&#x6CD5;&#x7684;AsyncTask&#x5728;AndroidStudio&#x4E2D;&#x4F1A;&#x6709;&#x8B66;&#x544A;&#x63D0;&#x793A;&#xFF0C;&#x63D0;&#x793A;&#x7684;&#x5185;&#x5BB9;&#x662F;&#xFF1A;</p>
<blockquote>
<p>This AsyncTask class should be static or leaks might occur (com.jasoncool.study.oom.asynctask.AsyncTaskOOMActivity.MyAsyncTask) less&#x2026; (Ctrl+F1)<br>A static field will leak contexts.  Non-static inner classes have an implicit reference to their outer class. If that outer class is for example a Fragment or Activity, then this reference means that the long-running handler/loader/task will hold a reference to the activity which prevents it from getting garbage collected.  Similarly, direct field references to activities and fragments from these longer running instances can cause leaks.  ViewModel classes should never point to Views or non-application Contexts.</p>
</blockquote>
<p>&#x8BF4;&#x767D;&#x4E86;&#x5176;&#x5B9E;&#x5C31;&#x662F;&#x544A;&#x8BC9;&#x4F60;&#xFF0C;&#x975E;&#x9759;&#x6001;&#x5185;&#x90E8;&#x7C7B;&#x8FD9;&#x4E48;&#x7528;&#x5C31;&#x5185;&#x5B58;&#x6CC4;&#x6F0F;&#x4E86;&#xFF0C;&#x8BA9;&#x4F60;&#x6539;&#x6B63;&#x8FC7;&#x6765;&#xFF0C;&#x6211;&#x4EEC;&#x770B;&#x4E00;&#x4E0B;&#x6539;&#x540E;&#x7684;&#x4EE3;&#x7801;&#xFF1A;</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AsyncTaskOOMActivity</span> <span class="keyword">extends</span> <span class="title">AppCompatActivity</span> </span>{</span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(@Nullable Bundle savedInstanceState)</span> </span>{</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        <span class="keyword">new</span> MyAsyncTask().execute();</span><br><span class="line">    }</span><br><span class="line">   <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">MyAsyncTask</span> <span class="keyword">extends</span> <span class="title">AsyncTask</span>&lt;<span class="title">Void</span>,<span class="title">Integer</span>,<span class="title">String</span>&gt;</span>{</span><br><span class="line">        <span class="annotation">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">protected</span> String <span class="title">doInBackground</span><span class="params">(Void... voids)</span> </span>{</span><br><span class="line">            <span class="keyword">try</span> {</span><br><span class="line">                Thread.sleep(<span class="number">5000</span>);</span><br><span class="line">            } <span class="keyword">catch</span> (InterruptedException e) {</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            }</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<p>&#x5C31;&#x662F;&#x8FD9;&#x4E48;&#x7B80;&#x5355;&#xFF0C;&#x52A0;&#x4E00;&#x4E2A;static&#x5173;&#x952E;&#x5B57;&#x5C31;&#x836F;&#x5230;&#x75C5;&#x9664;&#x4E86;&#x3002;</p>
<ol>
<li>Handler</li>
</ol>
<p>Handler&#x662F;&#x6211;&#x4EEC;&#x5728;&#x5F00;&#x53D1;&#x8FC7;&#x7A0B;&#x4E2D;&#x6BD4;&#x8F83;&#x5E38;&#x89C1;&#x7684;&#x5DE5;&#x5177;&#x7C7B;&#x4E86;&#xFF0C;&#x51E0;&#x4E4E;&#x662F;&#x6BCF;&#x4E2A;Android&#x7A0B;&#x5E8F;&#x5458;&#x5165;&#x95E8;&#x5FC5;&#x987B;&#x638C;&#x63E1;&#x7684;&#x77E5;&#x8BC6;&#x70B9;&#xFF0C;&#x4F46;&#x662F;&#x8FD9;&#x4E2A;&#x7C7B;&#x4E5F;&#x662F;&#x7ECF;&#x5E38;&#x51FA;&#x73B0;&#x5185;&#x5B58;&#x6CC4;&#x6F0F;&#x7684;&#x5143;&#x51F6;&#xFF0C;&#x5982;&#x679C;&#x4F7F;&#x7528;&#x4E0D;&#x597D;&#xFF0C;&#x4F1A;&#x5E26;&#x6765;&#x5F88;&#x591A;&#x610F;&#x60F3;&#x4E0D;&#x5230;&#x7684;&#x5185;&#x5B58;&#x6CC4;&#x6F0F;&#xFF0C;&#x4E0B;&#x9762;&#x8BF7;&#x770B;&#x4EE3;&#x7801;&#xFF1A;</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HandlerOOMActivity</span> <span class="keyword">extends</span> <span class="title">AppCompatActivity</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> TextView mTextView;</span><br><span class="line">    <span class="keyword">private</span> Handler mHandler = <span class="keyword">new</span> Handler(){</span><br><span class="line">        <span class="annotation">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handleMessage</span><span class="params">(Message msg)</span> </span>{</span><br><span class="line">            mTextView.setText(<span class="string">&quot;&#x5185;&#x5B58;&#x6EA2;&#x51FA;&#x4E86;&quot;</span>);</span><br><span class="line">        }</span><br><span class="line">    };</span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>{</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_main);</span><br><span class="line">        mTextView = (TextView) findViewById(R.id.text);<span class="comment">//&#x6A21;&#x62DF;&#x5185;&#x5B58;&#x6CC4;&#x9732;</span></span><br><span class="line">        loadData();</span><br><span class="line">        <span class="keyword">this</span>.finish();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">loadData</span><span class="params">()</span></span>{</span><br><span class="line">        mHandler.postDelayed(<span class="keyword">new</span> Runnable() {</span><br><span class="line">            <span class="annotation">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>{</span><br><span class="line">                <span class="comment">//&#x4EC0;&#x4E48;&#x90FD;&#x4E0D;&#x5E72; &#x5C31;&#x5EF6;&#x8FDF;180&#x79D2;</span></span><br><span class="line">            }</span><br><span class="line">        }, <span class="number">3</span> * <span class="number">60</span> * <span class="number">1000</span>);</span><br><span class="line"></span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onDestroy</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">super</span>.onDestroy();</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<p>&#x8FD9;&#x4E2A;&#x4F8B;&#x5B50;&#x5176;&#x5B9E;&#x548C;&#x4E0A;&#x4E00;&#x4E2A;AsyncTask&#x975E;&#x5E38;&#x7C7B;&#x4F3C;&#xFF0C;&#x53EA;&#x4E0D;&#x8FC7;&#x8FD9;&#x91CC;&#x591A;&#x4E86;&#x4E00;&#x4E2A;&#x6982;&#x5FF5;&#x5C31;&#x662F;&#x5728;&#x5185;&#x90E8;&#x7C7B;&#x4E2D;&#x6211;&#x4EEC;&#x5F15;&#x7528;&#x4E86;&#x5916;&#x90E8;&#x7C7B;&#x7684;TextView,&#x5982;&#x679C;&#x7B80;&#x5355;&#x7684;&#x5C06;Handler&#x6539;&#x6210;&#x9759;&#x6001;&#x5185;&#x90E8;&#x7C7B;&#x7684;&#x8BDD;&#xFF0C;&#x6211;&#x4EEC;&#x8FD8;&#x8BB0;&#x5F97; &#x9759;&#x6001;&#x5185;&#x90E8;&#x7C7B;&#x6709;&#x4E00;&#x4E2A;&#x7279;&#x70B9;&#x5C31;&#x662F;&#x6211;&#x4EEC;&#x65E0;&#x6CD5;&#x4F3C;&#x4E4E;&#x7528;&#x5916;&#x90E8;&#x7C7B;&#x7684;&#x975E;&#x9759;&#x6001;&#x8D44;&#x6E90;&#xFF0C;&#x90A3;&#x8FD9;&#x4E2A;TextView&#x5C31;&#x65E0;&#x6CD5;&#x5728;Handler&#x4E2D;&#x8FDB;&#x884C;&#x4F7F;&#x7528;&#x4E86;&#xFF0C;&#x90A3;&#x4E48;&#x8BE5;&#x5982;&#x4F55;&#x89E3;&#x51B3;&#x5462;&#xFF1F;&#x5176;&#x5B9E;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x4F20;&#x5165;&#x5916;&#x90E8;Activity&#x7684;Context&#x7684;&#x65B9;&#x5F0F;&#x6765;&#x89E3;&#x51B3;&#x8BE5;&#x95EE;&#x9898;&#xFF0C;&#x4E3A;&#x4E86;&#x4FDD;&#x9669;&#x8D77;&#x89C1;&#xFF0C;&#x8FD8;&#x53EF;&#x4EE5;&#x5C06;&#x8BE5;Context&#x8BBE;&#x7F6E;&#x6210;&#x5F31;&#x5F15;&#x7528;&#x7684;&#x65B9;&#x5F0F;&#x4F7F;&#x7528;&#xFF0C;&#x5E76;&#x4E14;&#x6211;&#x4EEC;&#x518D;onDestroy&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x8FD8;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;  mHandler.removeCallbacksAndMessages(null);&#x65B9;&#x6CD5;&#x6765;&#x4E2D;&#x7AEF;handler&#x7684;&#x8BF7;&#x6C42;&#x548C;&#x56DE;&#x8C03;&#xFF0C;&#x5E76;&#x5C06;handler&#x7F6E;&#x7A7A;&#xFF0C;&#x5177;&#x4F53;&#x770B;&#x4E0B;&#x9762;&#x7684;&#x4EE3;&#x7801;&#xFF1A;</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HandlerOOMActivity</span> <span class="keyword">extends</span> <span class="title">AppCompatActivity</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> TextView mTextView;</span><br><span class="line">    <span class="keyword">private</span> SoftHandler mHandler = <span class="keyword">new</span> SoftHandler(<span class="keyword">this</span>);</span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>{</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_main);</span><br><span class="line">        mTextView = (TextView) findViewById(R.id.text);<span class="comment">//&#x6A21;&#x62DF;&#x5185;&#x5B58;&#x6CC4;&#x9732;</span></span><br><span class="line">        loadData();</span><br><span class="line">        <span class="keyword">this</span>.finish();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">SoftHandler</span> <span class="keyword">extends</span> <span class="title">Handler</span></span>{</span><br><span class="line">        WeakReference&lt;Activity&gt; weakContext;</span><br><span class="line">         <span class="function"><span class="keyword">public</span> <span class="title">SoftHandler</span><span class="params">(Activity context)</span> </span>{</span><br><span class="line">            weakContext = <span class="keyword">new</span> WeakReference&lt;&gt;(context);</span><br><span class="line">        }</span><br><span class="line">        <span class="annotation">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handleMessage</span><span class="params">(Message msg)</span> </span>{</span><br><span class="line">            HandlerOOMActivity weakActivity= (HandlerOOMActivity)weakContext.get();</span><br><span class="line">            weakActivity.mTextView.setText(<span class="string">&quot;&#x5185;&#x5B58;&#x4E0D;&#x6EA2;&#x51FA;&#x4E86;&quot;</span>);</span><br><span class="line">        }</span><br><span class="line">    };</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">loadData</span><span class="params">()</span></span>{</span><br><span class="line">        mHandler.postDelayed(<span class="keyword">new</span> Runnable() {</span><br><span class="line">            <span class="annotation">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>{</span><br><span class="line">                <span class="comment">//&#x4EC0;&#x4E48;&#x90FD;&#x4E0D;&#x5E72; &#x5C31;&#x5EF6;&#x8FDF;180&#x79D2;</span></span><br><span class="line">            }</span><br><span class="line">        }, <span class="number">3</span> * <span class="number">60</span> * <span class="number">1000</span>);</span><br><span class="line"></span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onDestroy</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">super</span>.onDestroy();</span><br><span class="line">        mHandler.removeCallbacksAndMessages(<span class="keyword">null</span>);</span><br><span class="line">        mHandler=<span class="keyword">null</span>;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<p>&#x53EF;&#x4EE5;&#x770B;&#x5230;&#xFF0C;&#x867D;&#x7136;&#x5199;&#x6CD5;&#x590D;&#x6742;&#x4E86;&#x4E00;&#x4E9B;&#xFF0C;&#x4F46;&#x662F;&#x4E5F;&#x975E;&#x5E38;&#x597D;&#x7406;&#x89E3;&#xFF0C;&#x8FD9;&#x6837;&#x57FA;&#x672C;&#x4E0A;&#x5C31;&#x53EF;&#x4EE5;&#x907F;&#x514D;Handler&#x7684;&#x5185;&#x5B58;&#x6EA2;&#x51FA;&#x4E86;&#x3002;</p>
<p>3.Thread</p>
<p>&#x6211;&#x4EEC;&#x5728;&#x5F00;&#x53D1;&#x8FC7;&#x7A0B;&#x4E2D;&#xFF0C;&#x6709;&#x65F6;&#x5019;&#x4F1A;&#x65B0;&#x5EFA;&#x4E00;&#x4E2A;&#x7EBF;&#x7A0B;&#x6267;&#x884C;&#x4E00;&#x4E9B;&#x8017;&#x65F6;&#x64CD;&#x4F5C;&#xFF0C;&#x4F46;&#x662F;&#x5199;&#x8017;&#x65F6;&#x64CD;&#x4F5C;&#x65F6;&#x6211;&#x4EEC;&#x5EFA;&#x7ACB;&#x7684;&#x7EBF;&#x7A0B;&#x4E00;&#x822C;&#x90FD;&#x662F;&#x533F;&#x540D;&#x5185;&#x90E8;&#x7C7B;&#x7684;&#x65B9;&#x5F0F;&#x521B;&#x5EFA;&#x7684;&#xFF0C;&#x533F;&#x540D;&#x5185;&#x90E8;&#x7C7B;&#x4E5F;&#x4F1A;&#x6301;&#x6709;&#x5916;&#x90E8;&#x7C7B;&#x7684;&#x5F3A;&#x5F15;&#x7528;&#xFF0C;&#x4E00;&#x6837;&#x4F1A;&#x9047;&#x5230;&#x5185;&#x5B58;&#x6CC4;&#x6F0F;&#x7684;&#x95EE;&#x9898;&#xFF0C;&#x8BF7;&#x770B;&#x4EE3;&#x7801;&#xFF1A;</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ThreadOOMActivity</span> <span class="keyword">extends</span> <span class="title">AppCompatActivity</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>{</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_main);</span><br><span class="line">        <span class="keyword">new</span> Thread(<span class="keyword">new</span> Runnable() {</span><br><span class="line">            <span class="annotation">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>{</span><br><span class="line">                <span class="keyword">try</span> {</span><br><span class="line">                    Thread.sleep(<span class="number">50000</span>);</span><br><span class="line">                } <span class="keyword">catch</span> (InterruptedException e) {</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                }</span><br><span class="line">            }</span><br><span class="line">        }).start();</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<p>&#x8FD9;&#x4E2A;new Thread&#x5C31;&#x662F;&#x4E00;&#x4E2A;&#x533F;&#x540D;&#x5185;&#x90E8;&#x7C7B;&#x4E86;&#xFF0C;&#x5982;&#x679C;&#x5728;&#x7EBF;&#x7A0B;&#x4F11;&#x7720;&#x7684;&#x8FD9;&#x6BB5;&#x65F6;&#x95F4;&#x5185;&#x6211;&#x5173;&#x95ED;&#x4E86;&#x8BE5;Activity&#x7684;&#x8BDD;&#xFF0C;&#x4E00;&#x6837;&#x4F1A;&#x9020;&#x6210;&#x5185;&#x5B58;&#x6CC4;&#x6F0F;&#x7684;&#x95EE;&#x9898;&#xFF0C;&#x5EFA;&#x8BAE;&#x7684;&#x5199;&#x6CD5;&#x5E94;&#x5F53;&#x662F;&#xFF1A;</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ThreadOOMActivity</span> <span class="keyword">extends</span> <span class="title">AppCompatActivity</span> </span>{</span><br><span class="line">    SoftThread softThread;</span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>{</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_main);</span><br><span class="line">       softThread=<span class="keyword">new</span> SoftThread();</span><br><span class="line">       softThread.start();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">SoftThread</span>  <span class="keyword">extends</span>  <span class="title">Thread</span></span>{</span><br><span class="line">        <span class="annotation">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>{</span><br><span class="line">            <span class="comment">//&#x81EA;&#x5DF1;&#x7684;&#x6269;&#x5C55;...</span></span><br><span class="line">            <span class="keyword">try</span> {</span><br><span class="line">                Thread.sleep(<span class="number">50000</span>);</span><br><span class="line">            } <span class="keyword">catch</span> (InterruptedException e) {</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
</li>
</ol>
</li>
<li><p>&#x5355;&#x4F8B;&#x6A21;&#x5F0F;&#x5F15;&#x8D77;&#x7684;&#x5185;&#x5B58;&#x6CC4;&#x6F0F;</p>
<p>&#x5355;&#x4F8B;&#x6A21;&#x5F0F;&#x662F;&#x5F00;&#x53D1;&#x4EBA;&#x5458;&#x6700;&#x7ECF;&#x5E38;&#x63A5;&#x89E6;&#x7684;&#x4E00;&#x4E2A;&#x8BBE;&#x8BA1;&#x6A21;&#x5F0F;&#x4E86;&#xFF0C;&#x5176;&#x4E3B;&#x8981;&#x76EE;&#x7684;&#x662F;&#x4E3A;&#x4E86;&#x8BA9;&#x5E94;&#x7528;&#x4E2D;&#x53EA;&#x751F;&#x6210;&#x4E00;&#x4E2A;&#x5BF9;&#x8C61;&#x5728;&#x5E94;&#x7528;&#x4E2D;&#x4F7F;&#x7528;&#xFF0C;&#x56E0;&#x4E3A;&#x521B;&#x5EFA;&#x5BF9;&#x8C61;&#x4E5F;&#x8981;&#x8017;&#x8D39;&#x4E00;&#x5B9A;&#x7684;&#x8D44;&#x6E90;&#xFF0C;&#x9891;&#x7E41;&#x521B;&#x5EFA;&#x5BF9;&#x8C61;&#x80AF;&#x5B9A;&#x4E0D;&#x5982;&#x957F;&#x671F;&#x4F7F;&#x7528;&#x4E00;&#x4E2A;&#x5BF9;&#x8C61;&#x8981;&#x5408;&#x7406;&#xFF0C;&#x6240;&#x4EE5;&#x5355;&#x4F8B;&#x6A21;&#x5F0F;&#x7684;&#x5E94;&#x7528;&#x975E;&#x5E38;&#x5E7F;&#x6CDB;&#xFF0C;&#x4E00;&#x822C;&#x7684;&#x4EE3;&#x7801;&#x5982;&#x4E0B;&#xFF1A;</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SingleUtils</span> </span>{</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">volatile</span> SingleUtils mInstance = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">private</span> Context context;</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">SingleUtils</span> <span class="params">(Context context)</span></span>{</span><br><span class="line">        <span class="keyword">this</span>.context = context;</span><br><span class="line">    }</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> SingleUtils <span class="title">getInstance</span><span class="params">(Context context)</span></span>{</span><br><span class="line">        <span class="keyword">if</span>(mInstance == <span class="keyword">null</span>){</span><br><span class="line">            <span class="keyword">synchronized</span> (Singleton.class) {</span><br><span class="line">                <span class="keyword">if</span>(mInstance == <span class="keyword">null</span>)</span><br><span class="line">            mInstance = <span class="keyword">new</span> SingleUtils (context);</span><br><span class="line">            }</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">return</span> mInstance;</span><br><span class="line">    }</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">getObject</span><span class="params">()</span></span>{<span class="comment">//&#x6839;&#x636E;&#x4E1A;&#x52A1;&#x903B;&#x8F91;&#x4F20;&#x5165;&#x53C2;&#x6570;</span></span><br><span class="line">        <span class="comment">//&#x8FD4;&#x56DE;&#x4E1A;&#x52A1;&#x903B;&#x8F91;&#x7ED3;&#x679C;&#xFF0C;&#x8FD9;&#x91CC;&#x9700;&#x8981;&#x7528;&#x5230;context</span></span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<p>&#x4E00;&#x822C;&#x53EA;&#x8981;&#x4E0D;&#x51FA;&#x73B0;&#x91CD;&#x5927;&#x7684;&#x7A0B;&#x5E8F;&#x95EE;&#x9898;&#xFF0C;&#x5355;&#x4F8B;&#x6A21;&#x5F0F;&#x7684;&#x751F;&#x547D;&#x5468;&#x671F;&#x90FD;&#x662F;&#x8DDF;&#x5E94;&#x7528;&#x7684;&#x751F;&#x547D;&#x5468;&#x671F;&#x4E00;&#x81F4;&#x7684;&#xFF0C;&#x5982;&#x679C;&#x6211;&#x4EEC;&#x628A;&#x4E00;&#x4E2A;Activity&#x7684;Context&#x4F20;&#x7ED9;&#x4E86;&#x5355;&#x4F8B;&#x6A21;&#x5F0F;&#x7684;&#x903B;&#x8F91;&#x4E2D;&#xFF0C;&#x90A3;&#x4E48;&#x8FD9;&#x4E2A;&#x5355;&#x4F8B;&#x6A21;&#x5F0F;&#x7684;&#x9759;&#x6001;&#x53D8;&#x91CF;&#x5C31;&#x4F1A;&#x5F15;&#x7528;&#x4E86;&#x6211;&#x4EEC;&#x7684;Activity&#x7684;Context,&#x5728;&#x9ED8;&#x8BA4;&#x7684;&#x60C5;&#x51B5;&#x4E0B;&#x5C31;&#x4F1A;&#x9020;&#x6210;&#x5373;&#x4FBF;&#x5173;&#x95ED;&#x4E86;&#x8BE5;Activity&#xFF0C;&#x4E5F;&#x65E0;&#x6CD5;&#x5728;&#x5185;&#x4ECE;&#x4E2D;&#x56DE;&#x6536;&#x8BE5;Activity&#xFF0C;&#x4ECE;&#x800C;&#x5BFC;&#x81F4;&#x4E86;&#x5185;&#x5B58;&#x6CC4;&#x6F0F;&#x3002;</p>
<p>&#x89E3;&#x51B3;&#x65B9;&#x6848;&#xFF1A;</p>
<p>&#x5C06;&#x8BE5;Activity&#x7684;Context&#x6362;&#x6210;&#x751F;&#x547D;&#x5468;&#x671F;&#x8F83;&#x957F;&#x7684;ApplicationContext&#xFF0C;ApplicationContext&#x662F;&#x8DDF;&#x7740;&#x5E94;&#x7528;&#x7684;&#x751F;&#x547D;&#x5468;&#x671F;&#x800C;&#x5EFA;&#x7ACB;&#x548C;&#x9500;&#x6BC1;&#x7684;&#xFF0C;&#x8FD9;&#x6837;&#x5C31;&#x548C;&#x5355;&#x4F8B;&#x6A21;&#x5F0F;&#x7684;&#x4E00;&#x81F4;&#x4E86;&#xFF0C;&#x4E5F;&#x907F;&#x514D;&#x4E86;&#x5185;&#x5B58;&#x6CC4;&#x6F0F;&#x95EE;&#x9898;&#x7684;&#x53D1;&#x751F;&#x3002;</p>
</li>
<li><p>&#x8D44;&#x6E90;&#x4E0D;&#x53CA;&#x65F6;&#x56DE;&#x6536;&#x5F15;&#x8D77;&#x7684;&#x5185;&#x5B58;&#x6CC4;&#x9732;</p>
<p>&#x56FE;&#x7247;&#x52A0;&#x8F7D;&#x662F;&#x624B;&#x673A;&#x7AEF;&#x5360;&#x7528;&#x5185;&#x5B58;&#x7684;&#x5927;&#x6237;&#xFF0C;&#x5904;&#x7406;&#x4E0D;&#x597D;&#x56FE;&#x7247;&#x5F88;&#x5BB9;&#x6613;&#x9020;&#x6210;&#x5185;&#x5B58;&#x6CC4;&#x6F0F;&#xFF0C;&#x751A;&#x81F3;&#x5BFC;&#x81F4;&#x5185;&#x5B58;&#x6EA2;&#x51FA;&#xFF0C;&#x4E0D;&#x8FC7;&#x5904;&#x7406;&#x56FE;&#x7247;&#x9700;&#x8981;&#x8BB2;&#x89E3;&#x7684;&#x4E1C;&#x897F;&#x592A;&#x591A;&#x4E86;&#xFF0C;&#x6211;&#x5728;&#x8FD9;&#x91CC;&#x4E3B;&#x8981;&#x8BF4;&#x4E00;&#x4E0B;Bitmap&#x7684;&#x5185;&#x5B58;&#x6CC4;&#x6F0F;&#xFF0C;&#x81F3;&#x4E8E;&#x5982;&#x4F55;&#x4F18;&#x5316;&#x56FE;&#x7247;&#x7684;&#x6280;&#x672F;&#xFF0C;&#x5982;&#xFF1A;&#x56FE;&#x7247;&#x8D28;&#x91CF;&#x538B;&#x7F29;&#x3001;&#x56FE;&#x7247;&#x5C3A;&#x5BF8;&#x88C1;&#x526A;&#x3001;&#x6539;&#x53D8;&#x56FE;&#x7247;&#x989C;&#x8272;&#x6A21;&#x5F0F;&#x7B49;&#x77E5;&#x8BC6;&#x70B9;&#x8BF7;&#x81EA;&#x884C;&#x641C;&#x7D22;&#x5B66;&#x4E60;&#xFF0C;&#x6211;&#x5C31;&#x4E0D;&#x5C55;&#x5F00;&#x8BA8;&#x8BBA;&#x4E86;&#x3002;</p>
<p>&#x8BF4;&#x5230;Bitmap&#x5185;&#x5B58;&#x6CC4;&#x6F0F;&#xFF0C;&#x5176;&#x5B9E;&#x6700;&#x5927;&#x7684;&#x95EE;&#x9898;&#x5C31;&#x662F;&#x6CA1;&#x6709;&#x53CA;&#x65F6;&#x7684;&#x56DE;&#x6536;&#x8D44;&#x6E90;&#xFF0C;&#x53EA;&#x8981;&#x5728;&#x56FE;&#x7247;&#x4F7F;&#x7528;&#x5B8C;&#x540E;&#x8C03;&#x7528;recylce()&#x65B9;&#x6CD5;&#xFF0C;&#x5E76;&#x5C06;Bitmap&#x5BF9;&#x8C61;&#x8D4B;&#x503C;&#x4E3A;null&#x5C31;&#x53EF;&#x4EE5;&#x4E86;&#x3002;</p>
<p>&#x5F88;&#x591A;&#x5730;&#x65B9;&#x5176;&#x5B9E;&#x90FD;&#x9002;&#x7528;&#x8FD9;&#x79CD;&#x5904;&#x7406;&#x65B9;&#x5F0F;&#xFF0C;&#x6BD4;&#x5982; Sqlite&#x6570;&#x636E;&#x5E93;&#x5728;&#x67E5;&#x8BE2;&#x7ED3;&#x675F;&#x540E;&#x8981;&#x8BB0;&#x5F97;&#x5173;&#x95ED;Cursor.close(),&#x53C8;&#x6216;&#x8005;&#x6211;&#x4EEC;&#x5728;&#x5904;&#x7406;&#x5B8C;&#x6587;&#x4EF6;&#x6D41;&#x540E;&#x8981;&#x8BB0;&#x5F97;InputStream.close(),&#x4EE5;&#x53CA;EventBus&#x5728;&#x4F7F;&#x7528;&#x5B8C;&#x6210;&#x540E;&#x4E5F;&#x8981;&#x8BB0;&#x5F97;unregister()&#xFF0C;&#x7B49;&#x7B49;&#xFF0C;&#x8FD9;&#x4E9B;&#x77E5;&#x8BC6;&#x70B9;&#x8981;&#x5728;&#x5E73;&#x65F6;&#x5F00;&#x53D1;&#x7684;&#x8FC7;&#x7A0B;&#x4E2D;&#x5F88;&#x6CE8;&#x610F;&#xFF0C;&#x4E0D;&#x7136;&#x5C31;&#x4F1A;&#x4E3A;&#x672A;&#x6765;&#x7684;&#x9879;&#x76EE;&#x7EF4;&#x62A4;&#x57CB;&#x4E0B;&#x5404;&#x79CD;&#x6DF1;&#x5751;&#xFF0C;&#x8C28;&#x8BB0;&#x3002;</p>
</li>
<li><p>WebView&#x5F15;&#x8D77;&#x7684;&#x5185;&#x5B58;&#x6CC4;&#x6F0F;</p>
<p>WebView&#x4E3B;&#x8981;&#x662F;&#x7528;&#x6765;&#x52A0;&#x8F7D;&#x7F51;&#x9875;&#x7684;&#xFF0C;&#x5728;H5&#x5927;&#x884C;&#x5176;&#x9053;&#x7684;&#x4ECA;&#x5929;&#xFF0C;WebView&#x7684;&#x4F7F;&#x7528;&#x573A;&#x666F;&#x975E;&#x5E38;&#x5E38;&#x89C1;&#xFF0C;&#x5408;&#x7406;&#x7684;&#x91CA;&#x653E;WebView&#x5360;&#x7528;&#x7684;&#x8D44;&#x6E90;&#x4E5F;&#x662F;&#x5904;&#x7406;&#x5185;&#x5B58;&#x6CC4;&#x6F0F;&#x7684;&#x5173;&#x952E;&#xFF0C;&#x4E0B;&#x9762;&#x6211;&#x4EEC;&#x6765;&#x770B;&#x4E00;&#x4E0B;WebView&#x5982;&#x4F55;&#x91CA;&#x653E;&#x8D44;&#x6E90;&#xFF0C;&#x4EE3;&#x7801;&#x5982;&#x4E0B;&#xFF1A;</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">destroyWebView</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">if</span> (mWebView != <span class="keyword">null</span>) {</span><br><span class="line">            mWebView.pauseTimers();</span><br><span class="line">            mWebView.removeAllViews();</span><br><span class="line">            mWebView.destroy();</span><br><span class="line">            mWebView = <span class="keyword">null</span>;</span><br><span class="line">        }</span><br><span class="line">    }</span><br></pre></td></tr></table></figure>
</li>
<li><p>&#x5C5E;&#x6027;&#x52A8;&#x753B;&#x5F15;&#x8D77;&#x7684;&#x5185;&#x5B58;&#x6CC4;&#x6F0F;</p>
<p>&#x5C5E;&#x6027;&#x52A8;&#x753B;&#x4E2D;&#x6709;&#x4E00;&#x79CD;&#x52A8;&#x753B;&#x7684;&#x6267;&#x884C;&#x65F6;&#x95F4;&#x6A21;&#x5F0F;&#x662F;ValueAnimator.INFINITE&#xFF0C;&#x8FD9;&#x79CD;&#x65B9;&#x5F0F;&#x662F;&#x65E0;&#x9650;&#x5FAA;&#x73AF;&#x7684;&#x3002;&#x5982;&#x679C;&#x9875;&#x9762;&#x903B;&#x8F91;&#x6BD4;&#x8F83;&#x590D;&#x6742;&#xFF0C;&#x5C5E;&#x6027;&#x52A8;&#x753B;&#x53EF;&#x80FD;&#x4F1A;&#x548C;Handler&#x914D;&#x5408;&#x4F7F;&#x7528;&#xFF0C;&#x5728;&#x8FD9;&#x79CD;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x5C31;&#x6709;&#x53EF;&#x80FD;&#x9020;&#x6210;&#x5C5E;&#x6027;&#x52A8;&#x753B;&#x5185;&#x5B58;&#x6CC4;&#x6F0F;&#x4E86;&#xFF0C;&#x89E3;&#x51B3;&#x95EE;&#x9898;&#x7684;&#x65B9;&#x6CD5;&#x4E5F;&#x6BD4;&#x8F83;&#x7B80;&#x5355;&#xFF0C;&#x5728;&#x5173;&#x95ED;&#x8BE5;&#x9875;&#x9762;&#x524D;&#xFF0C;&#x5728;onDestory&#x65B9;&#x6CD5;&#x4E2D;&#x8C03;&#x7528;&#x5C5E;&#x6027;&#x52A8;&#x753B;&#x7684;cancel()&#x65B9;&#x6CD5;&#xFF0C;&#x5E76;&#x5C06;&#x8BE5;&#x52A8;&#x753B;&#x7684;&#x5BF9;&#x8C61;&#x7F6E;&#x4E3A;Null&#x5373;&#x53EF;&#x3002;</p>
</li>
<li><p>Service&#x5F15;&#x8D77;&#x7684;&#x5185;&#x5B58;&#x6CC4;&#x6F0F;</p>
<p>Service&#x505C;&#x6B62;&#x5931;&#x8D25;&#xFF0C;&#x4E5F;&#x4F1A;&#x5BFC;&#x81F4;&#x5185;&#x5B58;&#x6CC4;&#x6F0F;&#xFF0C;&#x56E0;&#x4E3A;&#x7CFB;&#x7EDF;&#x4F1A;&#x5C06;&#x8FD9;&#x4E2A;Service&#x6240;&#x5728;&#x7684;&#x8FDB;&#x7A0B;&#x8FDB;&#x884C;&#x4FDD;&#x7559;&#xFF0C;&#x5982;&#x679C;&#x8BE5;&#x8FDB;&#x7A0B;&#x8017;&#x5185;&#x5B58;&#x5F88;&#x5927;&#xFF0C;&#x4FBF;&#x4F1A;&#x9020;&#x6210;&#x5185;&#x5B58;&#x6CC4;&#x6F0F;&#xFF0C;&#x5BB9;&#x6613;&#x83AB;&#x540D;&#x7684;&#x5F15;&#x53D1;GC&#x3002;</p>
<p>&#x6240;&#x4EE5;&#x5728;&#x4F7F;&#x7528;Service&#x65B9;&#x9762;&#xFF0C;&#x53EF;&#x4EE5;&#x5C3D;&#x91CF;&#x5C1D;&#x8BD5;&#x4F7F;&#x7528;IntentService,IntentService&#x7684;&#x672C;&#x8D28;&#x5176;&#x5B9E;&#x5C31;&#x662F;Service+HandlerThread,&#x5B83;&#x6709;&#x5F88;&#x591A;&#x4F18;&#x70B9;&#xFF0C;&#x5176;&#x4E2D;&#x4E00;&#x4E2A;&#x5C31;&#x662F;IntentService&#x5728;&#x6267;&#x884C;&#x5B8C;&#x6307;&#x5B9A;&#x7684;&#x4EFB;&#x52A1;&#x540E;&#x4F1A;&#x81EA;&#x884C;&#x5173;&#x95ED;&#xFF0C;&#x4E0D;&#x7528;&#x7528;&#x6237;&#x624B;&#x52A8;&#x5173;&#x95ED;&#xFF0C;&#x907F;&#x514D;&#x4E86;&#x5185;&#x5B58;&#x6CC4;&#x6F0F;&#x7684;&#x53D1;&#x751F;,&#x4E0B;&#x9762;&#x6765;&#x770B;&#x4E00;&#x4E0B;IntentService&#x7684;&#x6E90;&#x7801;&#xFF1A;</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> android.app;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> android.annotation.WorkerThread;</span><br><span class="line"><span class="keyword">import</span> android.annotation.Nullable;</span><br><span class="line"><span class="keyword">import</span> android.content.Intent;</span><br><span class="line"><span class="keyword">import</span> android.os.Handler;</span><br><span class="line"><span class="keyword">import</span> android.os.HandlerThread;</span><br><span class="line"><span class="keyword">import</span> android.os.IBinder;</span><br><span class="line"><span class="keyword">import</span> android.os.Looper;</span><br><span class="line"><span class="keyword">import</span> android.os.Message;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">IntentService</span> <span class="keyword">extends</span> <span class="title">Service</span> </span>{</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">volatile</span> Looper mServiceLooper;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">volatile</span> ServiceHandler mServiceHandler;</span><br><span class="line">    <span class="keyword">private</span> String mName;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> mRedelivery;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">ServiceHandler</span> <span class="keyword">extends</span> <span class="title">Handler</span> </span>{</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">ServiceHandler</span><span class="params">(Looper looper)</span> </span>{</span><br><span class="line">            <span class="keyword">super</span>(looper);</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="annotation">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handleMessage</span><span class="params">(Message msg)</span> </span>{</span><br><span class="line">            onHandleIntent((Intent)msg.obj);</span><br><span class="line">            stopSelf(msg.arg1);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     * Creates an IntentService.  Invoked by your subclass&apos;s constructor.</span><br><span class="line">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">IntentService</span><span class="params">(String name)</span> </span>{</span><br><span class="line">        <span class="keyword">super</span>();</span><br><span class="line">        mName = name;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     * Sets intent redelivery preferences.  Usually called from the constructor</span><br><span class="line">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setIntentRedelivery</span><span class="params">(<span class="keyword">boolean</span> enabled)</span> </span>{</span><br><span class="line">        mRedelivery = enabled;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="comment">// <span class="doctag">TODO:</span> It would be nice to have an option to hold a partial wakelock</span></span><br><span class="line">        <span class="comment">// during processing, and to have a static startService(Context, Intent)</span></span><br><span class="line">        <span class="comment">// method that would launch the service &amp; hand off a wakelock.</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">super</span>.onCreate();</span><br><span class="line">        HandlerThread thread = <span class="keyword">new</span> HandlerThread(<span class="string">&quot;IntentService[&quot;</span> + mName + <span class="string">&quot;]&quot;</span>);</span><br><span class="line">        thread.start();</span><br><span class="line"></span><br><span class="line">        mServiceLooper = thread.getLooper();</span><br><span class="line">        mServiceHandler = <span class="keyword">new</span> ServiceHandler(mServiceLooper);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onStart</span><span class="params">(@Nullable Intent intent, <span class="keyword">int</span> startId)</span> </span>{</span><br><span class="line">        Message msg = mServiceHandler.obtainMessage();</span><br><span class="line">        msg.arg1 = startId;</span><br><span class="line">        msg.obj = intent;</span><br><span class="line">        mServiceHandler.sendMessage(msg);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     * You should not override this method for your IntentService. Instead,</span><br><span class="line">     */</span></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">onStartCommand</span><span class="params">(@Nullable Intent intent, <span class="keyword">int</span> flags, <span class="keyword">int</span> startId)</span> </span>{</span><br><span class="line">        onStart(intent, startId);</span><br><span class="line">        <span class="keyword">return</span> mRedelivery ? START_REDELIVER_INTENT : START_NOT_STICKY;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onDestroy</span><span class="params">()</span> </span>{</span><br><span class="line">        mServiceLooper.quit();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     * Unless you provide binding for your service, you don&apos;t need to implement this</span><br><span class="line">     */</span></span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="annotation">@Nullable</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> IBinder <span class="title">onBind</span><span class="params">(Intent intent)</span> </span>{</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     */</span></span><br><span class="line">    <span class="annotation">@WorkerThread</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">onHandleIntent</span><span class="params">(@Nullable Intent intent)</span></span>;</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<p>&#x6E90;&#x7801;&#x5E76;&#x4E0D;&#x591A;&#xFF0C;&#x5927;&#x5BB6;&#x5E94;&#x8BE5;&#x8981;&#x901A;&#x8BFB;&#x4E00;&#x4E0B;&#xFF0C;&#x5176;&#x4E2D;&#x5173;&#x952E;&#x4E00;&#x884C;&#x4EE3;&#x7801;&#x662F;26&#x884C;&#xFF1A;stopSelf(msg.arg1);</p>
<p>&#x8FD9;&#x91CC;stopSelf(msg.arg1),&#x4F1A;&#x5148;&#x770B;&#x961F;&#x5217;&#x4E2D;&#x662F;&#x5426;&#x6709;&#x6D88;&#x606F;&#x5F85;&#x5904;&#x7406;&#xFF0C;&#x5982;&#x679C;&#x6709;&#x5219;&#x7EE7;&#x7EED;&#x5904;&#x7406;&#x540E;&#x9762;&#x7684;&#x6D88;&#x606F;&#xFF0C;&#x6CA1;&#x6709;&#x624D;&#x4F1A;&#x5C06;Service&#x9500;&#x6BC1;&#x3002; </p>
</li>
<li><p>Static&#x5F15;&#x8D77;&#x7684;&#x5185;&#x5B58;&#x6CC4;&#x6F0F;</p>
<p>&#x5728;&#x975E;&#x5FC5;&#x8981;&#x7684;&#x60C5;&#x51B5;&#x4E0B;&#xFF0C;&#x4E0D;&#x8981;&#x8F7B;&#x6613;&#x7684;&#x4F7F;&#x7528;Static&#x6765;&#x4FEE;&#x9970;&#x6210;&#x5458;&#x53D8;&#x91CF;&#xFF0C;&#x8FD9;&#x4F1A;&#x5BFC;&#x81F4;&#x5176;&#x751F;&#x547D;&#x5468;&#x671F;&#x548C;app&#x8FDB;&#x7A0B;&#x7684;&#x751F;&#x547D;&#x5468;&#x671F;&#x4E00;&#x6837;&#xFF0C;&#x4ECE;&#x800C;&#x5728;&#x9759;&#x6001;&#x53D8;&#x91CF;&#x5927;&#x91CF;&#x5B58;&#x5728;&#x7684;&#x60C5;&#x51B5;&#x4E0B;&#x4F1A;&#x5BFC;&#x81F4;&#x5E94;&#x7528;&#x5185;&#x5B58;&#x5360;&#x7528;&#x91CF;&#x5927;&#x7684;&#x95EE;&#x9898;&#xFF0C;&#x4E14;&#x66F4;&#x5BB9;&#x6613;&#x88AB;&#x7CFB;&#x7EDF;&#x56DE;&#x6536;&#xFF0C;&#x89E3;&#x51B3;&#x65B9;&#x6848;&#x5C31;&#x662F;&#x5C3D;&#x91CF;&#x7528;&#x61D2;&#x52A0;&#x8F7D;&#x7684;&#x65B9;&#x5F0F;&#x6765;&#x5B9A;&#x4E49;&#x6210;&#x5458;&#x53D8;&#x91CF;&#x3002;Static&#x5F15;&#x8D77;&#x7684;&#x5185;&#x5B58;&#x6CC4;&#x6F0F;</p>
</li>
<li><p>&#x7528;&#x7F13;&#x5B58;&#x907F;&#x514D;&#x5185;&#x5B58;&#x6CC4;&#x6F0F;</p>
<p>&#x5F88;&#x5E38;&#x89C1;&#x7684;&#x4E00;&#x4E2A;&#x4F8B;&#x5B50;&#x5C31;&#x662F;&#x56FE;&#x7247;&#x7684;&#x4E09;&#x7EA7;&#x7F13;&#x5B58;&#x7ED3;&#x6784;&#xFF0C;&#x5206;&#x522B;&#x4E3A;&#x7F51;&#x7EDC;&#x7F13;&#x5B58;&#xFF0C;&#x672C;&#x5730;&#x7F13;&#x5B58;&#x4EE5;&#x53CA;&#x5185;&#x5B58;&#x7F13;&#x5B58;&#x3002;&#x5728;&#x5185;&#x5B58;&#x7F13;&#x5B58;&#x903B;&#x8F91;&#x7C7B;&#x4E2D;&#xFF0C;&#x901A;&#x5E38;&#x4F1A;&#x5B9A;&#x4E49;&#x8FD9;&#x6837;&#x7684;&#x96C6;&#x5408;&#x7C7B;&#x3002;</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> HashMap&lt;String, Bitmap&gt; mMemoryCache = <span class="keyword">new</span> HashMap&lt;String, Bitmap&gt;();<span class="comment">//String&#x7C7B;&#x4E3A;&#x8BE5;&#x56FE;&#x7247;&#x5BF9;&#x5E94;url</span></span><br></pre></td></tr></table></figure>
<p>&#x4E09;&#x7EA7;&#x7F13;&#x5B58;&#x7ED3;&#x6784;&#x8FC7;&#x7A0B;&#x4ECB;&#x7ECD;&#xFF1A;</p>
<p>&#x5728;&#x7528;&#x6237;&#x5207;&#x6362;&#x5230;&#x5C55;&#x793A;&#x56FE;&#x7247;&#x7684;&#x754C;&#x9762;&#x65F6;&#xFF0C;&#x5F53;&#x7136;&#x662F;&#x4F18;&#x5148;&#x5224;&#x65AD;&#x5185;&#x5B58;&#x7F13;&#x5B58;&#x662F;&#x5426;&#x4E3A;Null&#xFF0C;&#x4E0D;&#x4E3A;&#x7A7A;&#x76F4;&#x63A5;&#x5C55;&#x793A;&#x56FE;&#x7247;&#xFF0C;&#x82E5;&#x4E3A;&#x7A7A;&#xFF0C;&#x540C;&#x6837;&#x7684;&#x903B;&#x8F91;&#x53BB;&#x5224;&#x65AD;&#x672C;&#x5730;&#x7F13;&#x5B58;&#xFF08;&#x4E0D;&#x4E3A;&#x7A7A;&#x4FBF;&#x8BBE;&#x7F6E;&#x5185;&#x5B58;&#x7F13;&#x5B58;&#x5E76;&#x5C55;&#x793A;&#x56FE;&#x7247;&#xFF09;&#xFF0C;&#x672C;&#x5730;&#x7F13;&#x5B58;&#x518D;&#x4E3A;&#x7A7A;&#x624D;&#x4F1A;&#x6839;&#x636E;&#x8BE5;&#x56FE;&#x7247;&#x7684;url&#x7528;&#x7F51;&#x7EDC;&#x4E0B;&#x8F7D;&#x7C7B;&#x53BB;&#x4E0B;&#x8F7D;&#x8BE5;&#x56FE;&#x7247;&#x5E76;&#x5C55;&#x793A;&#x56FE;&#x7247;&#xFF08;&#x5F53;&#x7136;&#x4E86;&#xFF0C;&#x4E0B;&#x8F7D;&#x5230;&#x56FE;&#x7247;&#x540E;&#x4F1A;&#x6709;&#x8BBE;&#x7F6E;&#x672C;&#x5730;&#x7F13;&#x5B58;&#x4EE5;&#x53CA;&#x5185;&#x5B58;&#x7F13;&#x5B58;&#x7684;&#x64CD;&#x4F5C;&#xFF09;&#x3002;</p>
<p>&#x5185;&#x5B58;&#x6CC4;&#x6F0F;&#x7684;&#x95EE;&#x9898;&#x5C31;&#x51FA;&#x73B0;&#x5728;&#x5185;&#x5B58;&#x7F13;&#x5B58;&#x4E2D;&#xFF1A;&#x53EA;&#x8981;HashMap&#x5BF9;&#x8C61;&#x5B9E;&#x4F8B;&#x88AB;&#x5F15;&#x7528;&#xFF0C;&#x800C;Bitmap&#x5BF9;&#x8C61;&#x53C8;&#x90FD;&#x662F;&#x5F3A;&#x5F15;&#x7528;&#xFF0C;Bitmap&#x4E2D;&#x56FE;&#x7247;&#x8D8A;&#x6765;&#x8D8A;&#x591A;&#xFF0C;&#x5373;&#x4FBF;&#x662F;&#x5185;&#x5B58;&#x6EA2;&#x51FA;&#x4E86;&#xFF0C;&#x5783;&#x573E;&#x56DE;&#x6536;&#x5668;&#x4E5F;&#x4E0D;&#x4F1A;&#x5904;&#x7406;&#x3002;</p>
</li>
</ul>
<p>  &#x89E3;&#x51B3;&#x65B9;&#x6848;&#xFF1A;</p>
<p>  &#xFF08;1&#xFF09;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x9009;&#x62E9;&#x4F7F;&#x7528;&#x8F6F;&#x5F15;&#x7528;&#xFF0C;&#x4ECE;&#x800C;&#x5728;&#x5185;&#x5B58;&#x4E0D;&#x8DB3;&#x65F6;&#xFF0C;&#x5783;&#x573E;&#x56DE;&#x6536;&#x5668;&#x66F4;&#x5BB9;&#x6613;&#x56DE;&#x6536;Bitmap&#x5783;&#x573E;&#x3002;</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> HashMap&lt;String, SoftReference&lt;Bitmap&gt;&gt; mMemoryCache = <span class="keyword">new</span> HashMap&lt;String, SoftReference&lt;Bitmap&gt;&gt;();</span><br></pre></td></tr></table></figure>
<p>  &#xFF08;2&#xFF09;Android2.3&#x4EE5;&#x540E;&#xFF0C;SoftReference&#x4E0D;&#x518D;&#x53EF;&#x9760;&#x3002;&#x5783;&#x573E;&#x56DE;&#x6536;&#x671F;&#x66F4;&#x5BB9;&#x6613;&#x56DE;&#x6536;&#x5B83;&#xFF0C;&#x4E0D;&#x518D;&#x662F;&#x5185;&#x5B58;&#x4E0D;&#x8DB3;&#x65F6;&#x624D;&#x56DE;&#x6536;&#x8F6F;&#x5F15;&#x7528;&#x3002;&#x90A3;&#x4E48;&#x7F13;&#x5B58;&#x673A;&#x5236;&#x4FBF;&#x5931;&#x53BB;&#x4E86;&#x610F;&#x4E49;&#x3002;</p>
<p>  Google&#x5B98;&#x65B9;&#x5EFA;&#x8BAE;&#x4F7F;&#x7528;LruCache&#x4F5C;&#x4E3A;&#x7F13;&#x5B58;&#x7684;&#x96C6;&#x5408;&#x7C7B;&#x3002;&#x5176;&#x5B9E;&#x5185;&#x90E8;&#x5C01;&#x88C5;&#x4E86;LinkedHashMap&#x3002;&#x5185;&#x90E8;&#x539F;&#x7406;&#x662F;&#x4E00;&#x76F4;&#x5224;&#x65AD;&#x96C6;&#x5408;&#x5927;&#x5C0F;&#x662F;&#x5426;&#x8D85;&#x51FA;&#x7ED9;&#x5B9A;&#x7684;&#x6700;&#x5927;&#x503C;&#xFF0C;&#x8D85;&#x51FA;&#x5C31;&#x628A;&#x6700;&#x65E9;&#x6700;&#x5C11;&#x4F7F;&#x7528;&#x7684;&#x5BF9;&#x8C61;&#x8E22;&#x51FA;&#x96C6;&#x5408;&#x3002;</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> LruCache&lt;String, Bitmap&gt; mMemoryCache = <span class="keyword">new</span> LruCache&lt;String, Bitmap&gt;</span><br><span class="line">((<span class="keyword">int</span>)(Runtime.getRuntime().maxMemory()/<span class="number">8</span>)){ </span><br><span class="line"><span class="comment">//&#x7528;&#x6700;&#x5927;&#x5185;&#x5B58;&#x7684;1/8&#x5206;&#x914D;&#x7ED9;&#x8FD9;&#x4E2A;&#x96C6;&#x5408;&#x4F7F;&#x7528;</span></span><br><span class="line"><span class="comment">//&#x8BA9;&#x8FD9;&#x4E2A;&#x96C6;&#x5408;&#x77E5;&#x9053;&#x6BCF;&#x4E2A;&#x56FE;&#x7247;&#x7684;&#x5927;&#x5C0F;</span></span><br><span class="line"><span class="annotation">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">int</span> <span class="title">sizeOf</span><span class="params">(String key, Bitmap value)</span></span>{</span><br><span class="line"><span class="keyword">int</span> byteCount = value.getRowBytes() * value.getHeight();<span class="comment">//&#x8BA1;&#x7B97;&#x56FE;&#x7247;&#x5927;&#x5C0F;&#xFF0C;&#x6BCF;&#x884C;&#x5B57;&#x8282;&#x6570;*&#x9AD8;&#x5EA6;</span></span><br><span class="line"><span class="keyword">return</span> byteCount;</span><br><span class="line">  }</span><br><span class="line">};</span><br></pre></td></tr></table></figure>
<ul>
<li><p>&#x96C6;&#x5408;&#x7C7B;&#x5BFC;&#x81F4;&#x7684;&#x5185;&#x5B58;&#x6CC4;&#x6F0F;</p>
<p>&#x96C6;&#x5408;&#x7C7B;&#x6DFB;&#x52A0;&#x5143;&#x7D20;&#x540E;&#xFF0C;&#x4ECD;&#x5F15;&#x7528;&#x7740;&#x96C6;&#x5408;&#x5143;&#x7D20;&#x5BF9;&#x8C61;&#xFF0C;&#x5BFC;&#x81F4;&#x8BE5;&#x96C6;&#x5408;&#x4E2D;&#x7684;&#x5143;&#x7D20;&#x5BF9;&#x8C61;&#x65E0;&#x6CD5;&#x88AB;&#x56DE;&#x6536;&#xFF0C;&#x4ECE;&#x800C;&#x5BFC;&#x81F4;&#x5185;&#x5B58;&#x6CC4;&#x9732;&#xFF0C;&#x4E3E;&#x4E2A;&#x4F8B;&#x5B50;&#xFF1A;</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> List&lt;Object&gt; objectList = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) {</span><br><span class="line">      Object obj = <span class="keyword">new</span> Object();</span><br><span class="line">      objectList.add(obj);</span><br><span class="line">      obj = <span class="keyword">null</span>;</span><br><span class="line">   }</span><br></pre></td></tr></table></figure>
<p>&#x5728;&#x8FD9;&#x4E2A;&#x4F8B;&#x5B50;&#x4E2D;&#xFF0C;&#x5FAA;&#x73AF;&#x591A;&#x6B21;&#x5C06; new &#x51FA;&#x6765;&#x7684;&#x5BF9;&#x8C61;&#x653E;&#x5165;&#x4E00;&#x4E2A;&#x9759;&#x6001;&#x7684;&#x96C6;&#x5408;&#x4E2D;&#xFF0C;&#x56E0;&#x4E3A;&#x9759;&#x6001;&#x53D8;&#x91CF;&#x7684;&#x751F;&#x547D;&#x5468;&#x671F;&#x548C;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x4E00;&#x81F4;&#xFF0C;&#x800C;&#x4E14;&#x4ED6;&#x4EEC;&#x6240;&#x5F15;&#x7528;&#x7684;&#x5BF9;&#x8C61; Object &#x4E5F;&#x4E0D;&#x80FD;&#x91CA;&#x653E;&#xFF0C;&#x8FD9;&#x6837;&#x4FBF;&#x9020;&#x6210;&#x4E86;&#x5185;&#x5B58;&#x6CC4;&#x9732;&#x3002;</p>
<p><strong>&#x89E3;&#x51B3;&#x65B9;&#x6CD5;&#xFF1A;</strong>&#x5728;&#x96C6;&#x5408;&#x5143;&#x7D20;&#x4F7F;&#x7528;&#x4E4B;&#x540E;&#x4ECE;&#x96C6;&#x5408;&#x4E2D;&#x5220;&#x9664;&#xFF0C;&#x7B49;&#x6240;&#x6709;&#x5143;&#x7D20;&#x90FD;&#x4F7F;&#x7528;&#x5B8C;&#x4E4B;&#x540E;&#xFF0C;&#x5C06;&#x96C6;&#x5408;&#x7F6E;&#x7A7A;&#x3002;</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">objectList.clear();</span><br><span class="line">objectList = <span class="keyword">null</span>;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="&#x5185;&#x5B58;&#x6CC4;&#x6F0F;&#x603B;&#x7ED3;">&#x5185;&#x5B58;&#x6CC4;&#x6F0F;&#x603B;&#x7ED3;</h2><p>&#x8BF4;&#x4E86;&#x8FD9;&#x4E48;&#x591A;&#xFF0C;&#x5176;&#x5B9E;&#x8FD9;&#x4E9B;&#x77E5;&#x8BC6;&#x70B9;&#x5F88;&#x591A;&#x670B;&#x53CB;&#x5728;&#x5176;&#x4ED6;&#x6280;&#x672F;&#x6587;&#x7AE0;&#x4E2D;&#x4E5F;&#x90FD;&#x770B;&#x5230;&#x8FC7;&#x4E86;&#xFF0C;&#x6211;&#x8FD9;&#x91CC;&#x4E5F;&#x53EA;&#x662F;&#x505A;&#x4E86;&#x5F52;&#x7EB3;&#x548C;&#x603B;&#x7ED3;&#xFF0C;&#x5176;&#x4E2D;&#x6BD4;&#x8F83;&#x5173;&#x952E;&#x7684;&#x5C31;&#x662F;&#x5728;&#x5F00;&#x53D1;&#x7684;&#x8FC7;&#x7A0B;&#x4E2D;&#x4E00;&#x5B9A;&#x8981;&#x5FC3;&#x7EC6;&#xFF0C;&#x4E0D;&#x8981;&#x6015;&#x9EBB;&#x70E6;&#xFF0C;&#x5BF9;&#x4E00;&#x4E9B;&#x53EF;&#x80FD;&#x5B58;&#x5728;&#x7684;&#x5185;&#x5B58;&#x6CC4;&#x6F0F;&#x4E00;&#x5B9A;&#x8981;&#x53CA;&#x65F6;&#x7684;&#x5904;&#x7406;&#xFF0C;&#x517B;&#x6210;&#x826F;&#x597D;&#x7684;&#x7F16;&#x7A0B;&#x4E60;&#x60EF;&#x548C;&#x8D23;&#x4EFB;&#x5FC3;&#x3002;</p>
<p>&#x5E73;&#x65F6;&#x5728;&#x5F00;&#x53D1;&#x7684;&#x8FC7;&#x7A0B;&#x4E2D;&#xFF0C;&#x9664;&#x4E86;&#x77E5;&#x9053;&#x8FD9;&#x4E9B;&#x5185;&#x5B58;&#x6CC4;&#x6F0F;&#x7684;&#x77E5;&#x8BC6;&#x70B9;&#x5916;&#x8FD8;&#x5E94;&#x5F53;&#x5B66;&#x4E60;&#x548C;&#x5229;&#x7528;&#x4E00;&#x4E9B;&#x5DE5;&#x5177;&#x6765;&#x5E2E;&#x52A9;&#x81EA;&#x5DF1;&#x5206;&#x6790;&#x5E94;&#x7528;&#x7684;&#x5185;&#x5B58;&#x6CC4;&#x6F0F;&#x95EE;&#x9898;&#xFF0C;&#x8FD9;&#x91CC;&#x6211;&#x5148;&#x63A8;&#x8350;&#x4E24;&#x4E2A;&#xFF1A;&#x4E00;&#x4E2A;&#x662F;Android&#x7AEF;&#x7684;LeakCanary,&#x8FD8;&#x4E00;&#x4E2A;&#x662F;AndroidStudio3.0&#x51FA;&#x6765;&#x7684;Profiler&#x5206;&#x6790;&#x5668;&#xFF0C;&#x81F3;&#x4E8E;&#x600E;&#x4E48;&#x7528;&#xFF0C;&#x5927;&#x5BB6;&#x53EF;&#x4EE5;&#x81EA;&#x884C;&#x67E5;&#x8BE2;&#x76F8;&#x5173;&#x6587;&#x6863;&#x5B66;&#x4E60;&#xFF0C;&#x6211;&#x8FD9;&#x91CC;&#x5C31;&#x53EA;&#x662F;&#x629B;&#x4E2A;&#x7816;&#x3002;</p>
<p>&#x8C22;&#x8C22;&#x4F60;&#x770B;&#x5B8C;&#xFF01;</p>

      
    </div>

    <div>
      
        

      
    </div>

    <div>
      
        

      
    </div>

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/Android/" rel="tag">#Android</a>
          
        </div>
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2018/08/28/Springboot2.0中利用自定义属性动态设置SQL语句/" rel="next" title="Springboot2.0中利用自定义属性动态设置SQL语句">
                <i class="fa fa-chevron-left"></i> Springboot2.0中利用自定义属性动态设置SQL语句
              </a>
            
          </div>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2018/09/10/Android自定义View实例之横向进度轴/" rel="prev" title="Android自定义View实例之横向进度轴">
                Android自定义View实例之横向进度轴 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </article>



    <div class="post-spread">
      
        <!-- JiaThis Button BEGIN -->
<div class="jiathis_style">
  <a class="jiathis_button_tsina"></a>
  <a class="jiathis_button_tqq"></a>
  <a class="jiathis_button_weixin"></a>
  <a class="jiathis_button_cqq"></a>
  <a class="jiathis_button_douban"></a>
  <a class="jiathis_button_renren"></a>
  <a class="jiathis_button_qzone"></a>
  <a class="jiathis_button_kaixin001"></a>
  <a class="jiathis_button_copy"></a>
  <a href="http://www.jiathis.com/share" class="jiathis jiathis_txt jiathis_separator jtico jtico_jiathis" target="_blank"></a>
  <a class="jiathis_counter_style"></a>
</div>
<script type="text/javascript" >
  var jiathis_config={
    hideMore:false
  }
</script>
<script type="text/javascript" src="http://v3.jiathis.com/code/jia.js" charset="utf-8"></script>
<!-- JiaThis Button END -->

      
    </div>
  </div>


          </div>
          

  <p>热评文章</p>
  <div class="ds-top-threads" data-range="weekly" data-num-items="4"></div>


          
  <div class="comments" id="comments">
    
      <div class="ds-thread" data-thread-key="2018/08/29/Android-内存优化不完全手册/"
           data-title="Android 内存优化不完全手册" data-url="http://jasoncool.com/2018/08/29/Android-内存优化不完全手册/">
      </div>
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel ">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="http://tva2.sinaimg.cn/crop.0.0.720.720.180/460788ebjw8ep8yc024exj20k00k0tc2.jpg"
               alt="Mr.Cool" />
          <p class="site-author-name" itemprop="name">Mr.Cool</p>
          <p class="site-description motion-element" itemprop="description">热爱移动开发，专注移动技术</p>
        </div>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/">
              <span class="site-state-item-count">29</span>
              <span class="site-state-item-name">日志</span>
            </a>
          </div>

          
            <div class="site-state-item site-state-categories">
              <a href="/categories">
                <span class="site-state-item-count">7</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          
            <div class="site-state-item site-state-tags">
              
                <span class="site-state-item-count">5</span>
                <span class="site-state-item-name">标签</span>
              
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="http://weibo.com/lastcool" target="_blank" title="微博">
                  
                    <i class="fa fa-fw fa-globe"></i>
                  
                  微博
                </a>
              </span>
            
          
        </div>

        
        

        
        

      </section>

      
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">
            
              
            
            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#什么是内存泄漏"><span class="nav-number">1.</span> <span class="nav-text">什么是内存泄漏</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Java的四种引用"><span class="nav-number">2.</span> <span class="nav-text">Java的四种引用</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#常见内存泄漏"><span class="nav-number">3.</span> <span class="nav-text">常见内存泄漏</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#内存泄漏总结"><span class="nav-number">4.</span> <span class="nav-text">内存泄漏总结</span></a></li></ol></div>
            
          </div>
        </section>
      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Mr.Cool</span>
</div>

<div class="powered-by">
  由 <a class="theme-link" href="http://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Muse
  </a>
</div>

        

        
      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  



  
  <script type="text/javascript" src="/vendors/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/vendors/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/vendors/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/vendors/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/vendors/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/vendors/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.0.1"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.0.1"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.0.1"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.0.1"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.0.1"></script>



  

  
    
  

  <script type="text/javascript">
    var duoshuoQuery = {short_name:"jasoncool"};
    (function() {
      var ds = document.createElement('script');
      ds.type = 'text/javascript';ds.async = true;
      ds.id = 'duoshuo-script';
      ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
      ds.charset = 'UTF-8';
      (document.getElementsByTagName('head')[0]
      || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
  </script>

  
    
    <script src="/vendors/ua-parser-js/dist/ua-parser.min.js?v=0.7.9"></script>
    <script src="/js/src/hook-duoshuo.js"></script>
  






  
  
  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length == 0) {
       search_path = "search.xml";
    }
    var path = "/" + search_path;
    // monitor main search box;

    function proceedsearch() {
      $("body").append('<div class="popoverlay">').css('overflow', 'hidden');
      $('.popup').toggle();

    }
    // search function;
    var searchFunc = function(path, search_id, content_id) {
    'use strict';
    $.ajax({
        url: path,
        dataType: "xml",
        async: true,
        success: function( xmlResponse ) {
            // get the contents from search data
            isfetched = true;
            $('.popup').detach().appendTo('.header-inner');
            var datas = $( "entry", xmlResponse ).map(function() {
                return {
                    title: $( "title", this ).text(),
                    content: $("content",this).text(),
                    url: $( "url" , this).text()
                };
            }).get();
            var $input = document.getElementById(search_id);
            var $resultContent = document.getElementById(content_id);
            $input.addEventListener('input', function(){
                var matchcounts = 0;
                var str='<ul class=\"search-result-list\">';
                var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
                $resultContent.innerHTML = "";
                if (this.value.trim().length > 1) {
                // perform local searching
                datas.forEach(function(data) {
                    var isMatch = true;
                    var content_index = [];
                    var data_title = data.title.trim().toLowerCase();
                    var data_content = data.content.trim().replace(/<[^>]+>/g,"").toLowerCase();
                    var data_url = data.url;
                    var index_title = -1;
                    var index_content = -1;
                    var first_occur = -1;
                    // only match artiles with not empty titles and contents
                    if(data_title != '' && data_content != '') {
                        keywords.forEach(function(keyword, i) {
                            index_title = data_title.indexOf(keyword);
                            index_content = data_content.indexOf(keyword);
                            if( index_title < 0 && index_content < 0 ){
                                isMatch = false;
                            } else {
                                if (index_content < 0) {
                                    index_content = 0;
                                }
                                if (i == 0) {
                                    first_occur = index_content;
                                }
                            }
                        });
                    }
                    // show search results
                    if (isMatch) {
                        matchcounts += 1;
                        str += "<li><a href='"+ data_url +"' class='search-result-title'>"+ data_title +"</a>";
                        var content = data.content.trim().replace(/<[^>]+>/g,"");
                        if (first_occur >= 0) {
                            // cut out 100 characters
                            var start = first_occur - 20;
                            var end = first_occur + 80;
                            if(start < 0){
                                start = 0;
                            }
                            if(start == 0){
                                end = 50;
                            }
                            if(end > content.length){
                                end = content.length;
                            }
                            var match_content = content.substring(start, end);
                            // highlight all keywords
                            keywords.forEach(function(keyword){
                                var regS = new RegExp(keyword, "gi");
                                match_content = match_content.replace(regS, "<b class=\"search-keyword\">"+keyword+"</b>");
                            });

                            str += "<p class=\"search-result\">" + match_content +"...</p>"
                        }
                        str += "</li>";
                    }
                })};
                str += "</ul>";
                if (matchcounts == 0) { str = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>' }
                if (keywords == "") { str = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>' }
                $resultContent.innerHTML = str;
            });
            proceedsearch();
        }
    });}

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched == false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };

    });

    $('.popup-btn-close').click(function(e){
      $('.popup').hide();
      $(".popoverlay").remove();
      $('body').css('overflow', '');
    });
    $('.popup').click(function(e){
      e.stopPropagation();
    });
  </script>


  

  

  

</body>
</html>
